<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Orientation Audio Mixer (Howler.js)</title>
    <style>
        /* [Styles remain the same] */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        h1 {
            margin-bottom: 20px;
        }
        #output-orientation, #output-motion, #output-volume {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        #rotation-bar {
            width: 300px;
            height: 30px;
            background-color: #ddd;
            position: relative;
            border-radius: 15px;
            overflow: hidden;
        }
        #indicator {
            position: absolute;
            height: 100%;
            width: 50%;
            background-color: #007bff;
            left: 50%;
            transform-origin: center;
            transition: transform 0.1s;
        }
        #startButton, #playButton, #restartButton {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 10px;
        }
    </style>
    <!-- Include Howler.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
</head>
<body>

    <h1>Rotate Your Phone to Mix Audio</h1>
    <div id="output-orientation">Orientation: 0°</div>
    <div id="output-volume">Song A Volume: 0.5 | Song B Volume: 0.5</div>
    <div id="rotation-bar">
        <div id="indicator"></div>
    </div>
    <button id="startButton">Start</button>
    <button id="playButton">Play Audio</button>
    <button id="restartButton">Restart</button>

    <script>
        // Declare the sound variables without initializing
        var soundA;
        var soundB;

        const playButton = document.getElementById('playButton');
        const restartButton = document.getElementById('restartButton');
        const outputVolume = document.getElementById('output-volume'); // Reference for volume output

        // Add event listener to the button to request permissions on user gesture
        document.getElementById('startButton').addEventListener('click', () => {
            requestOrientationPermission();
        });

        playButton.addEventListener('click', () => {
            // Initialize the Howl objects inside a user interaction
            if (!soundA && !soundB) {
                soundA = new Howl({
                    src: ['test.mp3'],
                    loop: true,
                    volume: 0.5 // initial volume
                });
                soundB = new Howl({
                    src: ['test2.mp3'],
                    loop: true,
                    volume: 0.5 // initial volume
                });
            }

            // Resume AudioContext if suspended (iOS fix)
            if (Howler.ctx.state === 'suspended') {
                Howler.ctx.resume().then(() => {
                    soundA.play();
                    soundB.play();
                });
            } else {
                soundA.play();
                soundB.play();
            }
        });

        restartButton.addEventListener('click', () => {
            if (soundA && soundB) {
                soundA.stop();
                soundB.stop();
                soundA.play();
                soundB.play();
            }
        });

        function requestOrientationPermission() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                // Request permission for device orientation
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            initializeOrientationListener();
                        } else {
                            alert('Permission denied for accessing orientation data.');
                        }
                    })
                    .catch(console.error);
            } else {
                // No permission required for non-iOS devices
                initializeOrientationListener();
            }
        }

        function initializeOrientationListener() {
            // Handle device orientation events
            window.addEventListener("deviceorientation", handleOrientation);

            function handleOrientation(event) {
                const gamma = event.gamma; // Left-to-right tilt (gamma)

                // Update the text output for orientation
                const outputOrientation = document.getElementById('output-orientation');
                outputOrientation.textContent = `Orientation: ${gamma.toFixed(2)}°`;

                // Move the indicator to reflect rotation
                const indicator = document.getElementById('indicator');
                let position = gamma; // gamma is between -90 and 90
                position = Math.max(-45, Math.min(45, position)); // Clamp between -45 and 45
                let transformValue = (position / 45) * 100; // Map to percentage
                indicator.style.transform = `translateX(${transformValue}%)`;

                // Map gamma (-45 to 45) to volumes for songA and songB
                let volumeA, volumeB;
                if (gamma <= -45) {
                    volumeA = 1; // Full volume for songA
                    volumeB = 0; // Mute songB
                } else if (gamma >= 45) {
                    volumeA = 0; // Mute songA
                    volumeB = 1; // Full volume for songB
                } else {
                    // Calculate volumes based on tilt
                    // Normalize gamma from -45 to 45 into a range of 0 to 1
                    let normalized = (gamma + 45) / 90;
                    volumeA = 1 - normalized; // Inverse for songA
                    volumeB = normalized;     // Direct for songB
                }

                // Set the volumes on the Howl objects if they're initialized
                if (soundA && soundB) {
                    // Note: Programmatic volume changes may not work on iOS
                    soundA.volume(volumeA);
                    soundB.volume(volumeB);
                }

                // Update the displayed volumes for debugging
                outputVolume.textContent = `Song A Volume: ${volumeA.toFixed(2)} | Song B Volume: ${volumeB.toFixed(2)}`;
            }
        }
    </script>

</body>
</html>